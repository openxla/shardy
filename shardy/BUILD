load("@bazel_skylib//rules:expand_template.bzl", "expand_template")

package(default_visibility = ["//visibility:public"])

# Allow visibility from the mlir language server.
package_group(
    name = "friends",
    packages = [
        "//third_party/py/mlir/...",
        "//third_party/py/openxla/sdy/...",
        "//third_party/tensorflow/compiler/xla/service/spmd/shardy/...",
    ],
)

# Generates lit config input file by applying path placeholder substitutions
expand_template(
    name = "lit_site_cfg_py_gen",
    testonly = True,
    out = "lit.site.cfg.py",
    substitutions = {
        "\"@PROJECT_SOURCE_DIR@\"": "RUNFILES_DIR",
        "@LIT_SITE_CFG_IN_HEADER@": '''# Autogenerated, do not edit.
from python.runfiles import Runfiles
from pathlib import Path

r = Runfiles.Create()
RUNFILES_DIR = Path(r.Rlocation("shardy")).absolute().as_posix()''',
        "@LLVM_TOOLS_DIR@": "../llvm-project/llvm",
    },
    template = "lit.site.cfg.py.in",
)

filegroup(
    name = "lit_cfg",
    testonly = True,
    data = ["lit.cfg.py"],
)

filegroup(
    name = "lit_site_cfg",
    testonly = True,
    data = ["lit.site.cfg.py"],
)
